<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Form</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
</head>
<body>
  <h1>Dynamic Form</h1>

  <form id="TripForm">
    <label for="serviceType">Type of Service:</label>
    <select id="serviceType" name="serviceType">
      <option value="">Select service</option>
      <option value="Trek">Trek</option>
      <option value="Tour/Homestay/WFM">Tour/Homestay/WFM</option>
      <option value="CabRental">Cab Rental</option>
    </select>

    <!-- Section 1 -->
    <div id="section1">
      <h2>Section 1</h2>
      <label for="destination">Destination:</label>
      <input type="text" id="destination" name="destination" maxlength="20">
      
      <label for="tripStartDate">Trip Starting Date:</label>
      <input type="date" id="tripStartDate" name="tripStartDate">
      
      <label for="tripEndDate">Trip End Date:</label>
      <input type="date" id="tripEndDate" name="tripEndDate">
      
      <label for="bookingID">Booking ID:</label>
      <input type="text" id="bookingID" name="bookingID" maxlength="20">
      
      <label for="numberOfTravelers">No. Of Travelers:</label>
      <input type="number" id="numberOfTravelers" name="numberOfTravelers" min="1">

      <button type="button" id="goToSection2">Next</button>
    </div>

    <div id="section2" style="display: none;">
      <!-- Section 2 -->
      <h2>Section 2</h2>
      <!-- Your form fields here -->
      <div id="travelerInfoContainer">
        <!-- Traveler info will be added here -->
      </div>

    <input type="submit" value="Submit">
  </form>

  <script>
   $(document).ready(function() {
  // Update form fields when service type changes
  $('#serviceType').change(function() {
    if ($(this).val() === 'CabRental') {
      $('.foodChoice').hide();
      $('.foodAllergy').hide();
    } else {
      $('.foodChoice').show();
      $('.foodAllergy').show();
    }
  });

  $('#goToSection2').click(function() {
    $('#section1').hide();
    $('#section2').show();
  });

  // Update traveler info fields when number of travelers changes
  $('#numberOfTravelers').change(function() {
    var numberOfTravelers = $(this).val();

    // Clear the traveler info container
    $('#travelerInfoContainer').empty();

    // Add the traveler info fields for each traveler
    for (var i = 0; i < numberOfTravelers; i++) {
      $('#travelerInfoContainer').append(`
        <div class="travelerInfo">
          <h3>Traveler ${i + 1}</h3>

          <label for="travelerName${i}">Your Name:</label>
          <input type="text" id="travelerName${i}" name="travelerName${i}" maxlength="20">

          <label for="age${i}">Age:</label>
          <input type="number" id="age${i}" name="age${i}">

          <label for="gender${i}">Gender:</label>
          <select id="gender${i}" name="gender${i}">
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>

          <label for="email${i}">Email:</label>
          <input type="email" id="email${i}" name="email${i}" maxlength="20">

          <label for="phone${i}">Phone Number:</label>
          <input type="tel" id="phone${i}" name="phone${i}">

          <label for="idProof${i}">Voter/Aadhar Id proof (Max 10mb):</label>
          <input type="file" id="idProof${i}" name="idProof${i}">

          <label for="emergencyContactName${i}">Emergency Contact Name:</label>
          <input type="text" id="emergencyContactName${i}" name="emergencyContactName${i}" maxlength="30">

          <label for="emergencyContactNumber${i}">Emergency Contact Number:</label>
          <input type="tel" id="emergencyContactNumber${i}" name="emergencyContactNumber${i}">

          <label class="foodChoice" for="foodChoice${i}">What Food do you want to choose?</label>
          <select class="foodChoice" id="foodChoice${i}" name="foodChoice${i}">
            <option value="Veg">Veg</option>
            <option value="Nonveg">Nonveg</option>
            <option value="Only Egg">Only Egg</option>
            <option value="NA">N/A</option>
          </select>

          <label class="foodAllergy" for="foodAllergy${i}">Do you have any type of food allergies?</label>
          <select class="foodAllergy" id="foodAllergy${i}" name="foodAllergy${i}">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
            <option value="NA">N/A</option>
          </select>

          <label for="covidSymptoms${i}">Any type of Covid-19 Symptoms?</label>
          <select id="covidSymptoms${i}" name="covidSymptoms${i}">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>

          <label for="covidAffected${i}">Have you been affected with Covid-19 within the last 90 days?</label>
          <select id="covidAffected${i}" name="covidAffected${i}">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>

          <label for="vaccineDose${i}">Have you taken any dose of Covid-19 Vaccine?</label>
          <select id="vaccineDose${i}" name="vaccineDose${i}">
            <option value="No">No</option>
            <option value="Dose1">Dose 1</option>
            <option value="Both Dose">Both Dose</option>
          </select>

          <label for="vaccineCertificate${i}">If yes, upload your vaccination certificate (Max 10mb):</label>
          <input type="file" id="vaccineCertificate${i}" name="vaccineCertificate${i}">
        </div>
      `);
    }
  });
// Trigger the change event manually
$('#numberOfTravelers').change();
// AJAX function to submit the form
      $('#TripForm').submit(function(e) {
      e.preventDefault();
      alert('Form submitted'); // simple alert to verify the form submission event


      var data = $(this).serializeArray(); // This is an array of objects
      var travelerData = []; // This will store all traveler data

      data.forEach(function(item) {
        if (item.name.startsWith('traveler')) {
          travelerData.push(item);
          data.splice(data.indexOf(item), 1);
        }
      });

      data.push({name: 'travelers', value: JSON.stringify(travelerData)});

      var url = 'https://script.google.com/macros/s/AKfycbyYuAM1Z1_zCNoZQaiJsDcMiz_zeVhMhiR9uh-RJbqj0b13apt7kb4butPwi8Att3KUEw/exec';

      $.ajax({
        type: 'POST',
        url: url,
        data: $.param(data), // This converts our data array back into a serialized string
        success: function(data) {
          console.log('Submission successful');
        },
        error: function(err) {
          console.log('There was an error: ', err);
        }
      });
    });
  });
</script>
</body>
</html>
