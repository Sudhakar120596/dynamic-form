<!DOCTYPE html>
<html>
<head>
  <title>Fill Up all the details below</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
  <!-- Include the Firebase libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-storage.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
  <style>
    /* Global Styles */
    body {
      font-family: Arial, sans-serif;
      color: #333;
      background-color: #f9f9f9;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    /* Form Styles */
    form {
      max-width: 600px;
      margin: 0 auto;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: bold;
    }

    select,
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    input[type="number"] {
      display: block;
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }

    .phone-input {
      position: relative;
    }

    .phone-input .intl-tel-input {
      width: 100%;
      padding-left: 50px;
    }

    .phone-input .intl-tel-input .iti__selected-flag {
      position: absolute;
      top: 50%;
      left: 15px;
      transform: translateY(-50%);
    }

    .phone-input .intl-tel-input .iti__selected-dial-code {
      display: none;
    }

    input[type="submit"] {
      display: block;
      width: 100%;
      padding: 15px;
      background-color: #4CAF50;
      color: #ffffff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    input[type="submit"]:hover {
      background-color: #45a049;
    }

    /* Error Styles */
    label.error {
      display: inline-block;
      color: red;
      background-color: #f2dede;
      border-color: #ebccd1;
      padding: 5px;
      border-radius: 5px;
      font-size: 12px;
    }

    input.error {
      border: 1px solid red;
    }

    /* Additional Styles */
    .destination-label {
      display: none;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
      form {
        padding: 15px;
      }

      label,
      select,
      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="date"],
      input[type="number"],
      input[type="submit"] {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <h1>Fill Up all the details below</h1>
  
  <form id="TripForm">
    <label for="serviceType">Type of Service:</label>
    <select id="serviceType" name="serviceType" required onchange="showDestinationLabel()">
      <option value="">Select service</option>
      <option value="Trek">Trek</option>
      <option value="WorkFromMountains">Work From Mountains</option>
      <option value="BanzarasHomes">Banzaras Homes</option>
      <option value="WeekendGetaways">Weekend Getaways</option>
      <option value="WeeklongGetaways">Weeklong Getaways</option>
      <option value="CabRental">Cab Rental</option>
      
    </select>
    <div id="destinationLabel" style="display: none;">
        <label for="destination">Destination:</label>
        <input type="text" id="destination" name="destination" required>
    </div>
    
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" maxlength="20" required>
    
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    
    <div class="phone-input">
      <label for="phone">Phone Number:</label>
      <input type="tel" style="width:300px;" id="phone" name="phone" minlength="10" maxlength="10" required>
    </div>
    
    <label for="tripStartDate">Trip Starting Date:</label>
    <input type="date" id="tripStartDate" name="tripStartDate" required>
    
    <label for="tripEndDate">Trip End Date:</label>
    <input type="date" id="tripEndDate" name="tripEndDate" required>
    
    <label for="numberOfTravelers">No. Of Travelers:</label>
    <input type="number" id="numberOfTravelers" name="numberOfTravelers" min="1" value="1" required>
    
    <label for="numberOfChildren">No. of Child Below 5yr:</label>
    <input type="number" id="numberOfChildren" name="numberOfChildren" min="0" value="0">

    <label for="source">Source of Information:</label>
    <select id="source" name="source" required>
      <option value="">Select source</option>
      <option value="Instagram">Instagram</option>
      <option value="Facebook">Facebook</option>
      <option value="Youtube">Youtube</option>
      <option value="Google Search">Google Search</option>
      <option value="Banzaras Sales Executive">Banzaras Sales Executive</option>
      <option value="Friends">Friends</option>
    </select>
    <input type="text" id="executive" name="executive" placeholder="Enter Executive Name" style="display: none;">

    <input type="submit" value="Submit">
  </form>

  <script>
    // Initialize international telephone input for the main phone input field
    var input = document.querySelector("#phone");
    var itiPhone = window.intlTelInput(input, {
      utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
      initialCountry: "in",
      placeholderNumberType: "1",
      separateDialCode: true,  // Enables separate dial code display
      formatOnDisplay: true,  // Formats the phone number as the user types
    });
    
    function showDestinationLabel() {
      var serviceType = document.getElementById("serviceType").value;
      var destinationLabel = document.getElementById("destinationLabel");
      
      if (serviceType === "Trek") {
        var trekDestinations = [
          "Sandakphu Trek, West Bengal",
          "Sandakphu-Phalut Trek",
          "Sabargram-Phalut Trek, West Bengal",
          "Bajredara Trek, West Sikkim",
          "Phokteydara Trek, West Sikkim",
          "Singalila Pass Trek, West Sikkim",
          "Barsey Gorkhey Rhododendron Delight Hiking, West Sikkim",
          "Goechala Trek, West Sikkim",
          "Lost Valley Hiking, West Bengal",
          "Black Forest Hiking, West Bengal",
          "Dhotrey Delight Hiking, West Bengal",
          "Monal Top Trek, Uttarakhand",
          "Brahmataal Trek, Uttarakhand",
          "Valley of Flowers, Uttarakhand",
          "Ali Bedini Bugyal Trek, Uttarakhand",
          "Hampta Pass Trek, Himachal Pradesh",
          "Kashmir Great Lakes Trek, Kashmir",
          "Threesar/Silent Meadows Trek, Kashmir",
          "Tarsar Marsar Trek, Kashmir",
          "Hampta Pass Trek, Himachal Pradesh",
          "Chandrakhani Pass Trek, Himachal Pradesh",
          "Dzukou Valley Trek, Nagaland"
        ];
        createDestinationSelect(trekDestinations);
      } else if (serviceType === "WorkFromMountains") {
        var wfmDestinations = [
          "WFM Kalimpong Home 01, West Bengal",
          "WFM Darjeeling Home 01, West Bengal",
          "WFM Kurseong Home 01, West Bengal",
          "WFM Pelling Home 01, Pelling, West Sikkim",
          "WFM offbeat Samthar Home 01, Kalimpong, West Bengal",
          "WFM Gangtok Home 01, Gangtok, East Sikkim"
        ];
        createDestinationSelect(wfmDestinations);
      } else if (serviceType === "BanzarasHomes") {
        var homesDestinations = [
          "Riverview Homestay, Kurseong",
          "Banzara Home: The Basnett Croft, Gangtok",
          "Palash Bitan Eco Resort, Muruguma, Purulia, West Bengal",
          "Kaffer Home, Kaffergaon, near Loleygaon, North Bengal",
          "New Singalila Home, Srikhola, Darjeeling",
          "Rayena's Home, Darjeeling",
          "Vajra Kunj Home, Darjeeling",
          "Hotel Peak to Peaks, Darjeeling",
          "Pritam Home, Sepi village, Darjeeling",
          "Kanchan View Home, Dhotrey, Darjeeling",
          "Bethel Home, Lepchajagat",
          "Samther the nest Farm Stay, Samther",
          "Shanti Home, Gorkhey",
          "Charkhole Home, Charkhole",
          "Mayal Paradise Home, Rinchenpong, West Sikkim",
          "Kanchan View Home, Dhotrey, Darjeeling",
          "Banzara Makai Ghar Home, Dhotrey, Darjeeling",
          "Benesefzo Farmstay, Mirik",
          "Barsey Retreat Home, Okhrey, West Sikkim",
          "Laliguras Homestay, Okhrey",
          "Banzara Home: NayoNaitik Home, Samanden, Darjeeling",
          "Phenasha Home, Bhareng, West Sikkim",
          "Gurung Home, Sittong",
          "Sikher Home, Kalimpong",
          "Gurung Homestay, Tumling",
          "Ahan's Home, Dawaipani, Darjeeling",
          "Takto's Home, Mim, Darjeeling",
          "The Nest Farmstay, Samthar, Kalimpong",
          "Darjeeling Mountain Hidaway Home",
          "Aahl Homestay, Sandakphu",
          "Ranju Home, Majhidhura, Lepchajagat, Darjeeling"
        ];
        createDestinationSelect(homesDestinations);
      } else if (serviceType === "WeekendGetaways") {
        var getawayDestinations = [
          "Kaffergaon, Kalimpong",
           "Charkhole village, Kalimpong",
          "Dhotrey Forest Village, Darjeeling",
          "Srikhola, Darjeeling",
          "Chatakpur, Darjeeling",
          "Muruguma Dam, Purulia",
          "Jhilimili, Bankura"
        ];
        createDestinationSelect(getawayDestinations);
      } else if (serviceType === "WeeklongGetaways" || serviceType === "CabRental") {
        var weeklongCabDestinations = [
          "North Bengal Offbeat",
          "Sandakphu Trip By car",
          "North Sikkim",
          "West & South Sikkim",
          "East & West Sikkim",
          "Offbeat West Sikkim",
          "North & East Sikkim",
          "Silk Route, East Sikkim",
          "Enchanting Dooars",
          "Exotic Ladakh",
          "Jannat-e-Kashmir",
          "Meghalaya",
          "Arunachal Pradesh",
          "Splendid Spiti Circuit"
        ];
        createDestinationSelect(weeklongCabDestinations);
      } else {
        // Hide the destination label if no service is selected
        destinationLabel.innerHTML = "";
        destinationLabel.style.display = "none";
      }
    }
    
    function createDestinationSelect(destinations) {
      var destinationSelect = document.createElement("select");
      destinationSelect.id = "destination";
      destinationSelect.name = "destination";
      destinationSelect.required = true;
      
      var defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.text = "Select destination";
      destinationSelect.appendChild(defaultOption);
      
      for (var i = 0; i < destinations.length; i++) {
        var option = document.createElement("option");
        option.value = destinations[i];
        option.text = destinations[i];
        destinationSelect.appendChild(option);
      }
      
      var destinationLabel = document.getElementById("destinationLabel");
      destinationLabel.innerHTML = ""; // Clear previous content
      destinationLabel.appendChild(destinationSelect);
      destinationLabel.style.display = "block";
    }

    // Show the executive input field when "Banzaras Sales Executive" is selected
    $('#source').change(function() {
      var selectedOption = $(this).val();
      if (selectedOption === 'Banzaras Sales Executive') {
        $('#executive').show();
      } else {
        $('#executive').hide();
      }
    });
    
    $(document).ready(function() {
      const firebaseConfig = {
        apiKey: "AIzaSyDT1R0e9RHa6L9NWWV3Mk9SI6gYHIepe_0",
        authDomain: "customer-data-f1dd3.firebaseapp.com",
        projectId: "customer-data-f1dd3",
        storageBucket: "customer-data-f1dd3.appspot.com",
        messagingSenderId: "789752762056",
        appId: "1:789752762056:web:7d434ab157de5ede179ffd",
        measurementId: "G-4C2QQE2XGX"
      };
      
      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore(app);
      
      // Ensure that the trip end date is after the trip start date
      $('#tripStartDate').change(function() {
        var tripStartDate = $(this).val();
        $('#tripEndDate').attr('min', tripStartDate);
      });
      
      // AJAX function to submit the form
      $('#TripForm').submit(function(e) {
        e.preventDefault();
        
        // Get the form data
        var data = $(this).serializeArray();
        
        // Convert the form data to an object
        var formData = {};
        data.forEach(function(item) {
          formData[item.name] = item.value;
        });

        // Validate the email address with domain format
        var email = formData.email;
        var emailRegex = /^[A-Za-z0-9._%+-]+@(?:[A-Za-z0-9-]+\.)+(?:com|in)$/;
        if (!emailRegex.test(email)) {
          alert("Please enter a valid email address with a valid domain (e.g., username@domain.com or username@domain.in)");
          return;
        }

        // Validate form data...
        if (!$(this).valid()) {
          return;
        }

        // Add the country code to the phone number
        var phoneNumber = '+' + itiPhone.getSelectedCountryData().dialCode + formData.phone;
        
        // Update the formData object with the modified phone number
        formData.phone = phoneNumber;

        // Add the timestamp to the formData object
        formData.timestamp = firebase.firestore.FieldValue.serverTimestamp();
        
        // Disable the submit button
        var submitButton = $(this).find(':submit');
        submitButton.prop('disabled', true);
        
        // Then add the document to Firestore
        return db.collection("forms").add({
          formData: formData
        })
        .then((docRef) => {
          console.log("Document written with ID: ", docRef.id);
          // Hide the form after successful submission
          $('#TripForm').hide();
          
          // Show a success message
          $('body').append('<p> 🎉Your form has been successfully submitted!🎉</p><p>❤️Welcome to the Banzaras Family.❤️</p><p>😃Best wishes for your journey and enjoy your trip fully.😃</p>');
        })
        .catch((error) => {
          console.error("Error: ", error);
          alert('There was an error. Please try again.');
        })
        .finally(() => {
          // Enable the submit button again in the finally block so that it gets enabled whether the promise is fulfilled or rejected
          submitButton.prop('disabled', false);
        });
    });
    // Initialize the jQuery Validate plugin
    $('#TripForm').validate();
    });
  </script>
</body>
</html>
